<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Arabic', sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .editor-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            max-height: 90vh;
            overflow-y: auto;
        }

        .panel-title {
            font-size: 20px;
            font-weight: 900;
            color: #007BFF;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        input[type="color"],
        input[type="file"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Noto Sans Arabic', sans-serif;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #007BFF;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }

        input[type="color"] {
            height: 45px;
            cursor: pointer;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .update-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #007BFF, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            position: sticky;
            bottom: 80px;
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
            z-index: 10;
        }

        .update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4);
        }

        .print-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            position: sticky;
            bottom: 20px;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            z-index: 10;
        }

        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .preview-panel {
            position: sticky;
            top: 20px;
            display: flex;
            justify-content: center;
        }

        .discount-card {
            width: 100%;
            max-width: 500px;
            background: linear-gradient(135deg, #007BFF 0%, #0056b3 50%, #ffffff 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 123, 255, 0.3);
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .decoration {
            position: absolute;
            opacity: 0.1;
            font-size: 100px;
        }

        .decoration-1 {
            top: -20px;
            left: -20px;
        }

        .decoration-2 {
            bottom: -30px;
            right: -30px;
        }

        .content {
            position: relative;
            z-index: 10;
        }

        .header {
            margin-bottom: 30px;
        }

        .logo {
            font-size: 32px;
            font-weight: 900;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            word-break: break-word;
        }

        .tagline {
            color: #FFD700;
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .location {
            color: #ffffff;
            font-size: 13px;
            opacity: 0.95;
        }

        .main-title {
            font-size: 36px;
            font-weight: 900;
            color: white;
            margin: 25px 0;
            line-height: 1.3;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
            word-break: break-word;
        }

        .discount-badge {
            display: inline-block;
            background: #FF0000;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 28px;
            font-weight: 900;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .benefits {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }

        .benefit-item {
            background: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 10px;
            font-size: 12px;
            color: #333;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .benefit-item i {
            color: #FF0000;
            font-size: 20px;
        }

        .discount-percentage {
            background: linear-gradient(135deg, #FF0000, #FF6B6B);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 900;
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3);
        }

        .description {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            color: #333;
            line-height: 1.6;
            font-size: 13px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .qr-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .qr-codes-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .qr-code {
            width: 100%;
            aspect-ratio: 1;
            background: white;
            border: 2px solid #007BFF;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #007BFF;
            padding: 8px;
            text-align: center;
            box-sizing: border-box;
        }

        .qr-code img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        .qr-text {
            font-size: 12px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .social-follow {
            font-size: 12px;
            color: #333;
            margin-top: 10px;
            font-weight: 600;
        }

        .social-handle {
            color: #FF0000;
            font-weight: 900;
        }

        .footer {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 12px;
            margin-top: 20px;
            color: #333;
            font-size: 12px;
            line-height: 1.5;
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
            font-size: 11px;
        }

        .contact-info span {
            font-weight: 600;
        }

        .expiry-date {
            background: #FF0000;
            color: white;
            padding: 8px 12px;
            border-radius: 50px;
            font-weight: 900;
            margin-top: 10px;
            display: inline-block;
            font-size: 12px;
        }

        .print-container {
            display: none;
        }

        .export-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-in-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @media print {
            body {
                background: white;
            }

            .editor-panel {
                display: none;
            }

            .preview-panel {
                position: static;
                top: auto;
            }

            .container {
                grid-template-columns: 1fr;
            }

            .discount-card {
                box-shadow: none;
                max-width: 100%;
            }
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .preview-panel {
                position: static;
                top: auto;
            }

            .editor-panel {
                max-height: none;
            }
        }

        small {
            color: #999;
            font-size: 12px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* Toggle Button Styles */
        .toggle-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            background: #f9f9f9;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #555;
            transition: all 0.3s;
            text-align: center;
        }

        .toggle-btn:hover {
            background: #f0f0f0;
            border-color: #007BFF;
        }

        .toggle-btn.active {
            background: #007BFF;
            color: white;
            border-color: #007BFF;
            box-shadow: 0 3px 10px rgba(0, 123, 255, 0.3);
        }

        .bg-section {
            display: none;
        }

        .bg-section.active {
            display: block;
        }

        /* Draggable Elements */
        .draggable-text {
            cursor: grab;
            user-select: none;
            transition: box-shadow 0.2s;
            touch-action: none;
            position: relative;
        }

        .draggable-text:active {
            cursor: grabbing;
        }

        .draggable-text.selected {
            outline: 3px dashed #FFD700;
            outline-offset: 2px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            border-radius: 4px;
        }

        .draggable-image {
            cursor: grab;
            user-select: none;
            transition: box-shadow 0.2s;
            touch-action: none;
            position: relative;
            max-width: 100%;
            max-height: 100%;
        }

        .draggable-image:active {
            cursor: grabbing;
        }

        .draggable-image.selected {
            outline: 3px dashed #FFD700;
            outline-offset: 2px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            border-radius: 4px;
        }

        .draggable-section {
            cursor: grab;
            user-select: none;
            transition: box-shadow 0.2s;
            touch-action: none;
            position: relative;
            display: inline-block;
        }

        .draggable-section:active {
            cursor: grabbing;
        }

        .draggable-section.selected {
            outline: 3px dashed #FFD700;
            outline-offset: 2px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            border-radius: 4px;
        }

        /* Floating Toolbar */
        .floating-toolbar {
            position: fixed;
            background: white;
            border: 2px solid #007BFF;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 5000;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            max-width: 350px;
        }

        .toolbar-button {
            padding: 8px 12px;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #333;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .toolbar-button:hover {
            background: #007BFF;
            color: white;
            transform: translateY(-2px);
        }

        .toolbar-button.active {
            background: #007BFF;
            color: white;
            border-color: #0056b3;
        }

        .toolbar-divider {
            width: 1px;
            background: #ddd;
            margin: 0 4px;
        }

        .size-input-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .size-input-group input {
            width: 40px;
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .size-input-group input:focus {
            outline: none;
            border-color: #007BFF;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .export-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ­Ø±ÙŠØ± -->
        <div class="editor-panel">
            <div class="panel-title">
                <i class="fas fa-edit"></i> Ù…Ø­Ø±Ø± Ø§Ù„Ø¹Ø±Ø¶
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-store"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
                </div>
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
                    <input type="text" id="storeName" value="Alalamy Sharjah" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø´Ø¹Ø§Ø± Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠØ©</label>
                    <input type="text" id="tagline" value="Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù…Ù„Ùƒ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© â¤ï¸" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø´Ø¹Ø§Ø±">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…ÙƒØ§Ù†/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                    <input type="text" id="location" value="ÙØ±Ø¹ Ø§Ù„Ø´Ø§Ø±Ù‚Ø©" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙƒØ§Ù†">
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ù„ÙˆØµÙ -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-heading"></i> Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„ÙˆØµÙ
                </div>
                <div class="form-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
                    <textarea id="mainTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶">Ø¹Ø±ÙˆØ¶ Ø®ØµÙ… Ù…ØªÙ†ÙˆØ¹Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª! ğŸ‰</textarea>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <textarea id="description" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø´Ø±ÙˆØ·">â€¢ Ù„Ø­Ø§Ù…Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙÙ‚Ø·
â€¢ Ù„Ø§ ÙŠØ¬Ù…Ø¹ Ù…Ø¹ Ø¹Ø±ÙˆØ¶ Ø£Ø®Ø±Ù‰
â€¢ Ù…ØªÙˆÙØ± ÙÙŠ ÙØ±Ø¹ Ø§Ù„Ø´Ø§Ø±Ù‚Ø© ÙÙ‚Ø·</textarea>
                </div>
            </div>

            <!-- Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-image"></i> Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø®Ù„ÙÙŠØ©
                </div>
                <div class="form-group">
                    <label>ØªØ­Ù…ÙŠÙ„ Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©</label>
                    <input type="file" id="logoImage" accept="image/*">
                    <small>ğŸ“¤ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ù„Ø´Ø¹Ø§Ø± (PNG/JPG) - Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶</small>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label>Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¹Ø§Ø±</label>
                        <input type="range" id="logoWidth" min="20" max="150" value="60" style="width: 100%; cursor: pointer;">
                        <span id="logoWidthValue">60</span>px
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø±</label>
                        <input type="range" id="logoHeight" min="20" max="150" value="60" style="width: 100%; cursor: pointer;">
                        <span id="logoHeightValue">60</span>px
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="showLogo" onchange="updateFlyer()">
                        Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø¹Ø§Ø±
                    </label>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø§Ø®ØªØ± Ø¨ÙŠÙ† Ø§Ù„Ù„ÙˆÙ† Ø£Ùˆ Ø§Ù„ØµÙˆØ±Ø©) -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-image"></i> Ø§Ù„Ø®Ù„ÙÙŠØ©
                </div>
                
                <!-- Toggle Buttons -->
                <div class="toggle-group">
                    <button type="button" class="toggle-btn active" id="toggleColor" onclick="toggleBackground('color')">
                        <i class="fas fa-palette"></i> Ù„ÙˆÙ†
                    </button>
                    <button type="button" class="toggle-btn" id="toggleImage" onclick="toggleBackground('image')">
                        <i class="fas fa-image"></i> ØµÙˆØ±Ø©
                    </button>
                </div>

                <!-- Color Background Section -->
                <div class="bg-section active" id="colorSection">
                    <div class="form-group">
                        <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                        <input type="color" id="bgColor" value="#007BFF">
                        <small>Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ù„Ø®Ù„ÙÙŠØ©</small>
                    </div>
                </div>

                <!-- Image Background Section -->
                <div class="bg-section" id="imageSection">
                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                        <input type="file" id="backgroundImage" accept="image/*">
                        <small>ğŸ“¤ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ù„Ø®Ù„ÙÙŠØ© (PNG/JPG)</small>
                    </div>
                </div>
            </div>


            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-tags"></i> Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª ÙˆØ§Ù„ÙØ¦Ø§Øª
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0;">
                        <strong style="font-size: 12px; color: #666;">Ø§Ù„ÙØ¦Ø© 1</strong>
                        <div class="form-group" style="margin-bottom: 8px; margin-top: 8px;">
                            <label>Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©</label>
                            <input type="text" id="category1" value="ÙƒÙØ±Ø§Øª Ù…ÙˆØ¨Ø§ÙŠÙ„">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù†Ø³Ø¨Ø© (%)</label>
                            <input type="number" id="discount1" value="30" min="0" max="100">
                        </div>
                    </div>
                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0;">
                        <strong style="font-size: 12px; color: #666;">Ø§Ù„ÙØ¦Ø© 2</strong>
                        <div class="form-group" style="margin-bottom: 8px; margin-top: 8px;">
                            <label>Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©</label>
                            <input type="text" id="category2" value="Ø´ÙˆØ§Ø­Ù† ÙˆÙƒØ§Ø¨Ù„Ø§Øª">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù†Ø³Ø¨Ø© (%)</label>
                            <input type="number" id="discount2" value="25" min="0" max="100">
                        </div>
                    </div>
                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0;">
                        <strong style="font-size: 12px; color: #666;">Ø§Ù„ÙØ¦Ø© 3</strong>
                        <div class="form-group" style="margin-bottom: 8px; margin-top: 8px;">
                            <label>Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©</label>
                            <input type="text" id="category3" value="Ù…Ø§ÙˆØ³ ÙˆÙ„ÙˆØ­Ø§Øª Ù…ÙØ§ØªÙŠØ­">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù†Ø³Ø¨Ø© (%)</label>
                            <input type="number" id="discount3" value="20" min="0" max="100">
                        </div>
                    </div>
                    <div>
                        <strong style="font-size: 12px; color: #666;">Ø§Ù„ÙØ¦Ø© 4</strong>
                        <div class="form-group" style="margin-bottom: 8px; margin-top: 8px;">
                            <label>Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©</label>
                            <input type="text" id="category4" value="Ø³Ù…Ø§Ø¹Ø§Øª ÙˆØ£ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù†Ø³Ø¨Ø© (%)</label>
                            <input type="number" id="discount4" value="15" min="0" max="100">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ® -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø§ØªØµØ§Ù„
                </div>
                <div class="form-group">
                    <label>ØµØ§Ù„Ø­ Ø­ØªÙ‰ (Ø§Ù„ØªØ§Ø±ÙŠØ®)</label>
                    <input type="date" id="expiryDate" value="2025-12-31">
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="phoneNumber" placeholder="+971 50 123 4567">
                </div>
                <div class="form-group">
                    <label>Ø­Ø³Ø§Ø¨ TikTok @</label>
                    <input type="text" id="tiktokHandle" value="alalamy.sharjah">
                </div>
            </div>

            <!-- Ø§Ù„ØªØ®ØµÙŠØµ ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-palette"></i> Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØ®ØµÙŠØµ
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                        <input type="color" id="bgColor" value="#007BFF">
                    </div>
                    <div class="form-group">
                        <label>Ù„ÙˆÙ† Ø§Ù„Ø®ØµÙ…</label>
                        <input type="color" id="discountColor" value="#FF0000">
                    </div>
                </div>
            </div>

            <!-- ØµÙˆØ± QR Code -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-qrcode"></i> ØµÙˆØ± QR Code (4 ØµÙˆØ±)
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="form-group">
                        <label>QR Code 1</label>
                        <input type="file" id="qrImage1" accept="image/*">
                        <small>ğŸ“¤ Ø§Ø®ØªØ± ØµÙˆØ±Ø© QR</small>
                    </div>
                    <div class="form-group">
                        <label>QR Code 2</label>
                        <input type="file" id="qrImage2" accept="image/*">
                        <small>ğŸ“¤ Ø§Ø®ØªØ± ØµÙˆØ±Ø© QR</small>
                    </div>
                    <div class="form-group">
                        <label>QR Code 3</label>
                        <input type="file" id="qrImage3" accept="image/*">
                        <small>ğŸ“¤ Ø§Ø®ØªØ± ØµÙˆØ±Ø© QR</small>
                    </div>
                    <div class="form-group">
                        <label>QR Code 4</label>
                        <input type="file" id="qrImage4" accept="image/*">
                        <small>ğŸ“¤ Ø§Ø®ØªØ± ØµÙˆØ±Ø© QR</small>
                    </div>
                </div>
            </div>

            <!-- Ø­Ø¬Ù… Ø§Ù„ÙˆØ±Ù‚Ø© ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
            <div class="section-group">
                <div class="section-title">
                    <i class="fas fa-print"></i> Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
                </div>
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ø­Ø¬Ù… Ø§Ù„ÙˆØ±Ù‚Ø©</label>
                    <select id="paperSize">
                        <option value="half-a4">Ù†ØµÙ A4 (105 Ã— 148 Ù…Ù„Ù…)</option>
                        <option value="a6">A6 (105 Ã— 148 Ù…Ù„Ù…) - ØµØºÙŠØ±</option>
                        <option value="a5">A5 (148 Ã— 210 Ù…Ù„Ù…) - Ù…ØªÙˆØ³Ø·</option>
                        <option value="a4">A4 (210 Ã— 297 Ù…Ù„Ù…) - ÙƒØ¨ÙŠØ±</option>
                        <option value="letter">Letter (8.5 Ã— 11 Ø¨ÙˆØµØ©)</option>
                        <option value="custom">Ù…Ø®ØµØµ</option>
                    </select>
                </div>
                <div class="form-group" id="customSizeDiv" style="display: none;">
                    <label>Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ù‚Ø© (Ù…Ù„Ù…)</label>
                    <input type="number" id="customWidth" value="150" min="50" placeholder="Ø¹Ø±Ø¶">
                </div>
                <div class="form-group" id="customHeightDiv" style="display: none;">
                    <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ÙˆØ±Ù‚Ø© (Ù…Ù„Ù…)</label>
                    <input type="number" id="customHeight" value="210" min="50" placeholder="Ø§Ø±ØªÙØ§Ø¹">
                </div>
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø³Ø® ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©</label>
                    <select id="copiesPerPage">
                        <option value="1">Ù†Ø³Ø®Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</option>
                        <option value="2">Ù†Ø³Ø®ØªØ§Ù† (2)</option>
                        <option value="3">Ø«Ù„Ø§Ø« Ù†Ø³Ø® (3)</option>
                        <option value="4" selected>Ø£Ø±Ø¨Ø¹ Ù†Ø³Ø® (4)</option>
                        <option value="6">Ø³Øª Ù†Ø³Ø® (6)</option>
                        <option value="8">Ø«Ù…Ø§Ù†ÙŠ Ù†Ø³Ø® (8)</option>
                        <option value="9">ØªØ³Ø¹ Ù†Ø³Ø® (9)</option>
                    </select>
                </div>
            </div>

            <button class="update-btn" onclick="updateFlyer()">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            </button>

            <button class="print-btn" onclick="exportAsPNG()">
                <i class="fas fa-image"></i> ØªØµØ¯ÙŠØ± ÙƒÙ€ PNG
            </button>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
        <div class="preview-panel">
            <div class="discount-card" id="previewCard">
                <div class="decoration decoration-1">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <div class="decoration decoration-2">
                    <i class="fas fa-laptop"></i>
                </div>

                <div class="content">
                    <img class="draggable-image" id="previewLogoImage" style="display: none; width: 60px; height: 60px; margin-bottom: 15px; object-fit: contain;">
                    <div class="header">
                        <div class="logo draggable-text" id="previewStoreName">
                            <i class="fas fa-shop"></i> Alalamy Sharjah
                        </div>
                        <div class="tagline draggable-text" id="previewTagline">Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù…Ù„Ùƒ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© â¤ï¸</div>
                        <div class="location draggable-text">
                            <i class="fas fa-map-marker-alt"></i> <span id="previewLocation">ÙØ±Ø¹ Ø§Ù„Ø´Ø§Ø±Ù‚Ø©</span>
                        </div>
                    </div>

                    <div class="main-title draggable-text" id="previewMainTitle">Ø¹Ø±ÙˆØ¶ Ø®ØµÙ… Ù…ØªÙ†ÙˆØ¹Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª! ğŸ‰</div>

                    <div style="text-align: center;">
                        <div class="discount-badge draggable-text" id="previewBadge">Ù…Ù† 15% Ø¥Ù„Ù‰ 30% Ø®ØµÙ…</div>
                    </div>

                    <div class="benefits" id="benefitsSection">
                        <div class="benefit-item draggable-section" id="benefitItem1">
                            <i class="fas fa-mobile-alt"></i>
                            <div class="draggable-text" id="benefitLabel1">ÙƒÙØ±Ø§Øª Ù…ÙˆØ¨Ø§ÙŠÙ„</div>
                            <div class="discount-percentage draggable-text" id="benefitDiscount1">30% Ø®ØµÙ…</div>
                        </div>
                        <div class="benefit-item draggable-section" id="benefitItem2">
                            <i class="fas fa-charging-station"></i>
                            <div class="draggable-text" id="benefitLabel2">Ø´ÙˆØ§Ø­Ù† ÙˆÙƒØ§Ø¨Ù„Ø§Øª</div>
                            <div class="discount-percentage draggable-text" id="benefitDiscount2">25% Ø®ØµÙ…</div>
                        </div>
                        <div class="benefit-item draggable-section" id="benefitItem3">
                            <i class="fas fa-mouse"></i>
                            <div class="draggable-text" id="benefitLabel3">Ù…Ø§ÙˆØ³ ÙˆÙ„ÙˆØ­Ø§Øª Ù…ÙØ§ØªÙŠØ­</div>
                            <div class="discount-percentage draggable-text" id="benefitDiscount3">20% Ø®ØµÙ…</div>
                        </div>
                        <div class="benefit-item draggable-section" id="benefitItem4">
                            <i class="fas fa-headphones"></i>
                            <div class="draggable-text" id="benefitLabel4">Ø³Ù…Ø§Ø¹Ø§Øª ÙˆØ£ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</div>
                            <div class="discount-percentage draggable-text" id="benefitDiscount4">15% Ø®ØµÙ…</div>
                        </div>
                    </div>

                    <div class="description" id="previewDescription">
                        <strong class="draggable-text" id="descriptionTitle">âš ï¸ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong><br>
                        <div class="draggable-text" id="descriptionContent" style="margin-top: 10px; line-height: 1.8; font-size: 13px;">
                            â€¢ Ù„Ø­Ø§Ù…Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙÙ‚Ø·<br>
                            â€¢ Ù„Ø§ ÙŠØ¬Ù…Ø¹ Ù…Ø¹ Ø¹Ø±ÙˆØ¶ Ø£Ø®Ø±Ù‰<br>
                            â€¢ Ù…ØªÙˆÙØ± ÙÙŠ ÙØ±Ø¹ Ø§Ù„Ø´Ø§Ø±Ù‚Ø© ÙÙ‚Ø·
                        </div>
                    </div>

                    <div class="qr-section" id="qrSection">
                        <div class="qr-text draggable-text" id="qrTextLabel">ØªØ§Ø¨Ø¹Ù†Ø§:</div>
                        <div class="qr-codes-container">
                            <div class="qr-code draggable-section" id="previewQR1">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“±</div>
                                    <div style="font-size: 9px; color: #007BFF;">QR 1</div>
                                </div>
                            </div>
                            <div class="qr-code draggable-section" id="previewQR2">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“±</div>
                                    <div style="font-size: 9px; color: #007BFF;">QR 2</div>
                                </div>
                            </div>
                            <div class="qr-code draggable-section" id="previewQR3">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“±</div>
                                    <div style="font-size: 9px; color: #007BFF;">QR 3</div>
                                </div>
                            </div>
                            <div class="qr-code draggable-section" id="previewQR4">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“±</div>
                                    <div style="font-size: 9px; color: #007BFF;">QR 4</div>
                                </div>
                            </div>
                        </div>
                        <div class="social-follow">
                            ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰<br>
                            <span class="social-handle draggable-text" id="previewTikTok">@alalamy.sharjah</span>
                        </div>
                    </div>

                    <div class="footer" id="footerSection">
                        <div class="expiry-date draggable-text" id="previewExpiry">ØµØ§Ù„Ø­ Ø­ØªÙ‰ 31 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025</div>
                        <div class="contact-info draggable-text" id="previewContact">
                            <span><i class="fas fa-phone"></i> Ø§ØªØµÙ„ Ø¨Ù†Ø§</span>
                            <span><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø´Ø§Ø±Ù‚Ø©</span>
                        </div>
                        <div class="draggable-text" id="thankYouMessage" style="margin-top: 10px; font-size: 11px; color: #666;">
                            Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø±Ùƒ Alalamy Sharjah âœ¨
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function toggleBackground(mode) {
            const colorSection = document.getElementById('colorSection');
            const imageSection = document.getElementById('imageSection');
            const toggleColor = document.getElementById('toggleColor');
            const toggleImage = document.getElementById('toggleImage');
            
            if (mode === 'color') {
                colorSection.classList.add('active');
                imageSection.classList.remove('active');
                toggleColor.classList.add('active');
                toggleImage.classList.remove('active');
                
                // Remove background image and show color
                const previewCard = document.getElementById('previewCard');
                const bgColor = document.getElementById('bgColor').value;
                previewCard.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${bgColor}dd 50%, #ffffff 100%)`;
                previewCard.style.backgroundImage = 'none';
                currentBackgroundImage = null;
                document.getElementById('backgroundImage').value = '';
            } else {
                colorSection.classList.remove('active');
                imageSection.classList.add('active');
                toggleColor.classList.remove('active');
                toggleImage.classList.add('active');
            }
        }

        function updateFlyer() {
            const storeName = document.getElementById('storeName').value || 'Alalamy Sharjah';
            const tagline = document.getElementById('tagline').value;
            const location = document.getElementById('location').value;
            const mainTitle = document.getElementById('mainTitle').value;
            const description = document.getElementById('description').value;
            
            const d1 = document.getElementById('discount1').value;
            const d2 = document.getElementById('discount2').value;
            const d3 = document.getElementById('discount3').value;
            const d4 = document.getElementById('discount4').value;
            
            const cat1 = document.getElementById('category1').value;
            const cat2 = document.getElementById('category2').value;
            const cat3 = document.getElementById('category3').value;
            const cat4 = document.getElementById('category4').value;
            
            const expiryDate = document.getElementById('expiryDate').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const tiktokHandle = document.getElementById('tiktokHandle').value;
            
            const bgColor = document.getElementById('bgColor').value;
            const discountColor = document.getElementById('discountColor').value;

            const discounts = [parseInt(d1), parseInt(d2), parseInt(d3), parseInt(d4)];
            const minDiscount = Math.min(...discounts);
            const maxDiscount = Math.max(...discounts);

            const dateObj = new Date(expiryDate);
            const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 
                           'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
            const arabicDate = `${dateObj.getDate()} ${months[dateObj.getMonth()]} ${dateObj.getFullYear()}`;

            const previewCard = document.getElementById('previewCard');
            
            // Handle background - check if image section is active
            const imageSection = document.getElementById('imageSection');
            const isImageMode = imageSection.classList.contains('active');
            
            if (isImageMode && currentBackgroundImage) {
                // Image mode - use background image
                previewCard.style.background = '';
                previewCard.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${currentBackgroundImage}')`;
                previewCard.style.backgroundSize = 'cover';
                previewCard.style.backgroundPosition = 'center';
            } else {
                // Color mode - use color gradient - FORCE IT!
                const gradient = `linear-gradient(135deg, ${bgColor} 0%, ${bgColor}dd 50%, #ffffff 100%)`;
                previewCard.style.backgroundImage = 'none !important';
                previewCard.style.backgroundColor = bgColor;
                previewCard.style.background = gradient + ' !important';
            }
            previewCard.style.boxShadow = `0 10px 40px ${bgColor}66`;

            // Handle logo
            const showLogo = document.getElementById('showLogo').checked;
            const logoImg = document.getElementById('previewLogoImage');
            const logoWidth = document.getElementById('logoWidth').value;
            const logoHeight = document.getElementById('logoHeight').value;
            
            if (showLogo && logoImg.src) {
                logoImg.style.display = 'block';
                logoImg.style.width = logoWidth + 'px';
                logoImg.style.height = logoHeight + 'px';
            } else {
                logoImg.style.display = 'none';
            }

            document.getElementById('previewStoreName').innerHTML = `<i class="fas fa-shop"></i> ${storeName}`;
            document.getElementById('previewTagline').textContent = tagline;
            document.getElementById('previewLocation').textContent = location;
            document.getElementById('previewMainTitle').textContent = mainTitle;

            const badgeElement = document.getElementById('previewBadge');
            badgeElement.textContent = `Ù…Ù† ${minDiscount}% Ø¥Ù„Ù‰ ${maxDiscount}% Ø®ØµÙ…`;
            badgeElement.style.background = `linear-gradient(135deg, ${discountColor}, ${discountColor}cc)`;
            badgeElement.style.boxShadow = `0 5px 15px ${discountColor}66`;

            for (let i = 1; i <= 4; i++) {
                const labelElement = document.getElementById(`benefitLabel${i}`);
                const discountElement = document.getElementById(`benefitDiscount${i}`);
                const categoryValue = document.getElementById(`category${i}`).value;
                const discountValue = document.getElementById(`discount${i}`).value;
                
                if (labelElement) labelElement.textContent = categoryValue;
                if (discountElement) {
                    discountElement.textContent = `${discountValue}% Ø®ØµÙ…`;
                    discountElement.style.background = `linear-gradient(135deg, ${discountColor}, ${discountColor}aa)`;
                    discountElement.style.boxShadow = `0 2px 8px ${discountColor}77`;
                }
            }

            const descriptionDiv = document.getElementById('previewDescription');
            const descriptionTitle = document.getElementById('descriptionTitle');
            const descriptionContent = document.getElementById('descriptionContent');
            
            if (descriptionTitle) {
                descriptionTitle.textContent = 'âš ï¸ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:';
            }
            if (descriptionContent) {
                descriptionContent.innerHTML = description.split('\n').map(line => `${line}`).join('<br>');
            }

            const expiryElement = document.getElementById('previewExpiry');
            expiryElement.textContent = `ØµØ§Ù„Ø­ Ø­ØªÙ‰ ${arabicDate}`;
            expiryElement.style.background = discountColor;

            const contactInfo = document.getElementById('previewContact');
            let contactHTML = '';
            if (phoneNumber) {
                contactHTML += `<span><i class="fas fa-phone"></i> ${phoneNumber}</span>`;
            }
            contactHTML += `<span><i class="fas fa-map-marker-alt"></i> ${location}</span>`;
            contactInfo.innerHTML = contactHTML;

            document.getElementById('previewTikTok').textContent = `@${tiktokHandle}`;

            // Ù…Ø¹Ø§Ù„Ø¬Ø© 4 ØµÙˆØ± QR
            for (let i = 1; i <= 4; i++) {
                const qrFile = document.getElementById(`qrImage${i}`).files[0];
                const qrElement = document.getElementById(`previewQR${i}`);
                
                if (qrFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        qrElement.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">`;
                    };
                    reader.readAsDataURL(qrFile);
                } else {
                    qrElement.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“±</div>
                            <div style="font-size: 9px; color: #007BFF;">QR ${i}</div>
                        </div>
                    `;
                }
            }
            
            // Re-initialize drag and drop for all elements
            setTimeout(() => {
                initDragAndDrop();
            }, 50);
        }

        function exportAsPNG() {
            const previewCard = document.getElementById('previewCard');
            const storeName = document.getElementById('storeName').value || 'discount';
            
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©
            html2canvas(previewCard, {
                scale: 3, // Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©
                backgroundColor: '#ffffff',
                logging: false,
                allowTaint: true,
                useCORS: true
            }).then(canvas => {
                // ØªØ­ÙˆÙŠÙ„ Canvas Ø¥Ù„Ù‰ ØµÙˆØ±Ø©
                const image = canvas.toDataURL('image/png');
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„
                const link = document.createElement('a');
                link.href = image;
                link.download = `${storeName}-discount-flyer.png`;
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                showNotification('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            }).catch(err => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', err);
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'error');
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'export-notification';
            notification.textContent = message;
            notification.style.background = type === 'error' ? '#dc3545' : '#28a745';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        window.addEventListener('load', updateFlyer);

        const allInputs = document.querySelectorAll('input, textarea, select');
        allInputs.forEach(input => {
            input.addEventListener('change', updateFlyer);
            input.addEventListener('input', updateFlyer);
        });

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø®Ø§ØµØ© Ù„Ø­Ù‚ÙˆÙ„ QR
        document.getElementById('qrImage1').addEventListener('change', updateFlyer);
        document.getElementById('qrImage2').addEventListener('change', updateFlyer);
        document.getElementById('qrImage3').addEventListener('change', updateFlyer);
        document.getElementById('qrImage4').addEventListener('change', updateFlyer);

        // Specific listener for background color - DIRECT UPDATE
        const bgColorInput = document.getElementById('bgColor');
        bgColorInput.addEventListener('change', () => {
            const bgColor = bgColorInput.value;
            const previewCard = document.getElementById('previewCard');
            const imageSection = document.getElementById('imageSection');
            const isImageMode = imageSection.classList.contains('active');
            
            if (!isImageMode || !currentBackgroundImage) {
                const gradient = `linear-gradient(135deg, ${bgColor} 0%, ${bgColor}dd 50%, #ffffff 100%)`;
                previewCard.style.background = gradient + ' !important';
                previewCard.style.backgroundImage = 'none !important';
                previewCard.style.backgroundColor = bgColor;
            }
            previewCard.style.boxShadow = `0 10px 40px ${bgColor}66`;
            updateFlyer();
        });
        
        bgColorInput.addEventListener('input', () => {
            const bgColor = bgColorInput.value;
            const previewCard = document.getElementById('previewCard');
            const imageSection = document.getElementById('imageSection');
            const isImageMode = imageSection.classList.contains('active');
            
            if (!isImageMode || !currentBackgroundImage) {
                const gradient = `linear-gradient(135deg, ${bgColor} 0%, ${bgColor}dd 50%, #ffffff 100%)`;
                previewCard.style.background = gradient + ' !important';
                previewCard.style.backgroundImage = 'none !important';
                previewCard.style.backgroundColor = bgColor;
            }
            previewCard.style.boxShadow = `0 10px 40px ${bgColor}66`;
        });
        
        // Specific listener for discount color
        document.getElementById('discountColor').addEventListener('change', updateFlyer);
        document.getElementById('discountColor').addEventListener('input', updateFlyer);

        document.getElementById('paperSize').addEventListener('change', function() {
            const customDiv = document.getElementById('customSizeDiv');
            const customHeightDiv = document.getElementById('customHeightDiv');
            if (this.value === 'custom') {
                customDiv.style.display = 'block';
                customHeightDiv.style.display = 'block';
            } else {
                customDiv.style.display = 'none';
                customHeightDiv.style.display = 'none';
            }
        });

        // ===== DRAG AND DROP FUNCTIONALITY =====
        let selectedElement = null;
        let currentToolbar = null;
        const elementPositions = {};
        const elementStyles = {};

        // Logo handlers
        document.getElementById('logoImage').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const logoImg = document.getElementById('previewLogoImage');
                    logoImg.src = event.target.result;
                    document.getElementById('showLogo').checked = true;
                    updateFlyer();
                    setTimeout(() => initDragAndDrop(), 50);
                };
                reader.readAsDataURL(file);
            }
        });

        // Logo size handlers
        document.getElementById('logoWidth').addEventListener('input', (e) => {
            document.getElementById('logoWidthValue').textContent = e.target.value;
            const logoImg = document.getElementById('previewLogoImage');
            logoImg.style.width = e.target.value + 'px';
            updateFlyer();
        });

        document.getElementById('logoHeight').addEventListener('input', (e) => {
            document.getElementById('logoHeightValue').textContent = e.target.value;
            const logoImg = document.getElementById('previewLogoImage');
            logoImg.style.height = e.target.value + 'px';
            updateFlyer();
        });

        // Background image handler
        let currentBackgroundImage = null;
        
        document.getElementById('backgroundImage').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentBackgroundImage = event.target.result;
                    
                    // Auto-switch to image mode when image is uploaded
                    toggleBackground('image');
                    
                    updateFlyer();
                };
                reader.readAsDataURL(file);
            }
        });

        function initDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable-text, .draggable-image, .draggable-section');
            
            draggables.forEach(element => {
                element.onmousedown = null;
                element.onclick = null;
            });

            draggables.forEach(element => {
                element.style.position = 'relative';
                element.style.transform = elementPositions[element.id]?.transform || 'translate(0, 0)';

                element.onmousedown = (e) => {
                    if (e.button !== 0) return;
                    e.preventDefault();
                    e.stopPropagation();
                    selectElement(element);
                    startDrag(e, element);
                };

                element.onclick = (e) => {
                    e.stopPropagation();
                    selectElement(element);
                    if (element.classList.contains('draggable-text')) {
                        showTextToolbar(element);
                    }
                };
            });

            const previewCard = document.getElementById('previewCard');
            previewCard.onclick = (e) => {
                if (e.target === previewCard) {
                    deselectElement();
                }
            };
        }

        function startDrag(e, element) {
            const previewCard = document.getElementById('previewCard');
            const cardRect = previewCard.getBoundingClientRect();
            const startX = e.clientX;
            const startY = e.clientY;

            function onMouseMove(moveEvent) {
                const deltaX = moveEvent.clientX - startX;
                const deltaY = moveEvent.clientY - startY;
                element.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
            }

            function onMouseUp(upEvent) {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                
                const style = window.getComputedStyle(element);
                const transform = style.transform;
                elementPositions[element.id] = { transform: element.style.transform };
            }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        }

        function selectElement(element) {
            deselectElement();
            selectedElement = element;
            element.classList.add('selected');
        }

        function deselectElement() {
            if (selectedElement) {
                selectedElement.classList.remove('selected');
                selectedElement = null;
            }
            if (currentToolbar) {
                currentToolbar.remove();
                currentToolbar = null;
            }
        }

        function showTextToolbar(element) {
            if (currentToolbar) currentToolbar.remove();

            const toolbar = document.createElement('div');
            toolbar.className = 'floating-toolbar';

            const currentAlign = window.getComputedStyle(element).textAlign || 'right';
            const currentSize = window.getComputedStyle(element).fontSize;
            const currentDirection = window.getComputedStyle(element).direction || 'rtl';

            // Alignment buttons
            const alignContainer = document.createElement('div');
            alignContainer.style.display = 'flex';
            alignContainer.style.gap = '4px';

            ['ÙŠÙ…ÙŠÙ†', 'ÙˆØ³Ø·', 'ÙŠØ³Ø§Ø±'].forEach((label, idx) => {
                const alignments = ['right', 'center', 'left'];
                const align = alignments[idx];
                const btn = document.createElement('button');
                btn.className = 'toolbar-button';
                if (currentAlign === align) btn.classList.add('active');
                btn.innerHTML = `<i class="fas fa-align-${align}"></i> ${label}`;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    element.style.textAlign = align;
                    showTextToolbar(element);
                };
                alignContainer.appendChild(btn);
            });
            toolbar.appendChild(alignContainer);

            // Divider
            const divider1 = document.createElement('div');
            divider1.className = 'toolbar-divider';
            divider1.style.height = '30px';
            toolbar.appendChild(divider1);

            // Direction buttons
            const directionContainer = document.createElement('div');
            directionContainer.style.display = 'flex';
            directionContainer.style.gap = '4px';

            ['RTL', 'LTR'].forEach((label) => {
                const direction = label === 'RTL' ? 'rtl' : 'ltr';
                const btn = document.createElement('button');
                btn.className = 'toolbar-button';
                if (currentDirection === direction) btn.classList.add('active');
                btn.innerHTML = `<i class="fas fa-arrow-${direction === 'rtl' ? 'right' : 'left'}"></i> ${label}`;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    element.style.direction = direction;
                    showTextToolbar(element);
                };
                directionContainer.appendChild(btn);
            });
            toolbar.appendChild(directionContainer);

            // Divider
            const divider2 = document.createElement('div');
            divider2.className = 'toolbar-divider';
            divider2.style.height = '30px';
            toolbar.appendChild(divider2);

            // Font size
            const sizeContainer = document.createElement('div');
            sizeContainer.style.display = 'flex';
            sizeContainer.style.alignItems = 'center';
            sizeContainer.style.gap = '8px';

            const sizeLabel = document.createElement('label');
            sizeLabel.textContent = 'Ø§Ù„Ø­Ø¬Ù…:';
            sizeLabel.style.fontSize = '12px';
            sizeContainer.appendChild(sizeLabel);

            const sizeInput = document.createElement('input');
            sizeInput.type = 'number';
            sizeInput.min = '8';
            sizeInput.max = '48';
            sizeInput.value = parseInt(currentSize);
            sizeInput.style.width = '40px';
            sizeInput.oninput = (e) => {
                element.style.fontSize = e.target.value + 'px';
            };
            sizeContainer.appendChild(sizeInput);

            const unit = document.createElement('span');
            unit.textContent = 'px';
            unit.style.fontSize = '12px';
            sizeContainer.appendChild(unit);
            toolbar.appendChild(sizeContainer);

            // Close button
            const divider3 = document.createElement('div');
            divider3.className = 'toolbar-divider';
            divider3.style.height = '30px';
            toolbar.appendChild(divider3);

            const closeBtn = document.createElement('button');
            closeBtn.className = 'toolbar-button';
            closeBtn.innerHTML = '<i class="fas fa-times"></i>';
            closeBtn.onclick = (e) => {
                e.stopPropagation();
                toolbar.remove();
                currentToolbar = null;
            };
            toolbar.appendChild(closeBtn);

            document.body.appendChild(toolbar);
            currentToolbar = toolbar;

            const rect = element.getBoundingClientRect();
            toolbar.style.left = Math.max(10, rect.right - 180) + 'px';
            toolbar.style.top = Math.max(10, rect.bottom + 15) + 'px';
        }

        function resetPositions() {
            const draggables = document.querySelectorAll('.draggable-text, .draggable-image');
            draggables.forEach(element => {
                element.style.transform = 'translate(0, 0)';
                element.classList.remove('selected');
            });
            
            for (let key in elementPositions) {
                delete elementPositions[key];
            }
            
            selectedElement = null;
            showNotification('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ø¶Ø¹');
            setTimeout(() => initDragAndDrop(), 50);
        }

        // Initialize on load
        window.addEventListener('load', () => {
            // Force set background color immediately with !important
            const bgColor = document.getElementById('bgColor').value;
            const previewCard = document.getElementById('previewCard');
            const gradient = `linear-gradient(135deg, ${bgColor} 0%, ${bgColor}dd 50%, #ffffff 100%)`;
            previewCard.style.background = gradient + ' !important';
            previewCard.style.backgroundImage = 'none !important';
            previewCard.style.backgroundColor = bgColor;
            previewCard.style.boxShadow = `0 10px 40px ${bgColor}66`;
            
            // Call updateFlyer after a small delay to ensure DOM is ready
            setTimeout(() => {
                updateFlyer();
                setTimeout(() => initDragAndDrop(), 200);
            }, 100);
        });
    </script>
</body>
</html>
